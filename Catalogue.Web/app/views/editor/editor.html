<div>
    
    <form name="theForm" novalidate>
        
        <!-- top row of buttons etc.  -->
        <div class="row">
            <div class="col-md-6">
                <div ng-show="form.readOnly" class="form-group editor-readonly">
                    <span class="well well-sm" tc-tip title="This record is read-only">
                        <span class="glyphicon glyphicon-lock hoverable-glyphicon"></span>
                        <span ng-show="!isClean()"> This record is read-only and can't be saved</span>
                    </span>
                </div>
            </div>
            <div class="col-md-6">
                <div class="form-group pull-right">
                    <button class="btn btn-default icon-and-text-btn" tc-back-button>
                        <span class="dark glyphicon glyphicon-circle-arrow-left"></span>BACK
                    </button>
                    <span>
                        <button ng-click="cancel()" ng-hide="isCancelHidden()" class="btn btn-primary" >CANCEL</button>
                        <button ng-click="save()"  ng-hide="isSaveHidden()" ng-disabled="isSaveDisabled()" class="btn btn-danger">SAVE</button>
                    </span>
                </div>
            </div>

        </div>

        <!-- validation summary -->
        <div ng-show="validation.errors" class="editor-validation-summary">
            <div ng-repeat="e in validation.errors" class="editor-validation-summary-item">
                {{e.message}}
            </div>
        </div>

        <!-- title -->
        <div class="row">
            <div class="col-md-12">
                <div class="form-group">
                    <input type="text" ng-model="form.gemini.title" name="gemini.title" placeholder="Title" class="editor-title form-control"
                           title="The title or name of the resource"
                           tc-server-validated
                           tc-focus-tip />
                </div>

            </div>
        </div>
        
        <!-- format and path -->
        <div class="layout-row">
            <div class="layout-col editor-format">
                <div class="panel panel-default" tc-qtip-title id="testSt" ng-click="collapseDataFormatSelector = !collapseDataFormatSelector">
                    <span tabindex="0" class="dark glyphicon" ng-class="lookups.currentDataFormat.glyph"></span>
                </div>
            </div>
            <div class="layout-col">
                <div class="well well-sm form-group">
                    <div class="editor-path input-group">
                        <span class="input-group-addon well-input-group-addon">
                            <span class="dark glyphicon glyphicon-th-large"></span>
                        </span>

                        <input id="form-path" name="path" ng-model="form.path" 
                               type="text" class="form-control" 
                               placeholder="Location"
                               tc-server-validation
                               tc-focus-tip title="The path to the resource on the file share"
                               spellcheck="false" />
                        
                        <span class="input-group-addon pointable"
                              ng-disabled="!form.path"
                              tc-copy-path-to-clipboard="form-path"
                              data-clipboard-target="form-path">
                            <span class="dark glyphicon glyphicon-folder-open"></span>
                        </span>

                        <!--                        <span class="input-group-btn">-->
                        <!--                            <button class="btn btn-primary" type="button" tabindex="-1"-->
                        <!--                                    ng-disabled="!form.path"-->
                        <!--                                    tc-copy-path-to-clipboard="form-path"-->
                        <!--                                    data-clipboard-target="form-path">-->
                        <!--                                <span class="glyphicon glyphicon-new-window"></span>-->
                        <!--                            </button>-->
                        <!--                        </span>-->
                    </div>
                </div>
            </div>
        </div>
        
        <div collapse="collapseDataFormatSelector" class="form-group">
            <div style="display:block;">
                <div class="well">
                    <span>Currently Selected: <span class="dark glyphicon" ng-class="lookups.currentDataFormat.glyph"></span><span> {{lookups.currentDataFormat.type}} - {{lookups.currentDataFormat.text}}<span ng-show="lookups.currentDataFormat.code">{{'(' + lookups.currentDataFormat.code + ')'}}</span></span></span>
                    <span style="float:right;"><button type="button" class="close" aria-hidden="true" ng-click="collapseDataFormatSelector = !collapseDataFormatSelector">&times;</button></span>
                </div>
                <div>
                    <tabset>
                        <tab ng-repeat="format in lookups.formats">
                            <tab-heading class="tab-heading">
                                <i class="glyphicon {{format.glyph}}"></i> {{format.name}}
                            </tab-heading>
                            <ul ng-if="format.formats.length > 0" class="list-inline">
                                <li ng-repeat="type in format.formats" class="data-format-list-item" ng-click="lookups.currentDataFormat = updateDataFormatObj(type.name, lookups.formats, form)">
                                    <span class="glyphicon {{format.glyph}} data-format-list-item-glyph"></span>
                                    <span class="data-format-list-item-text">{{type.name}} <span ng-show="type.code">{{'(' + type.code + ')'}}</span></span>                                
                                </li>
                            </ul>
                            <ul ng-if="format.formats.length == 0" class="list-inline">
                                <li class="data-format-list-item" ng-click="lookups.currentDataFormat = updateDataFormatObj(undefined, undefined, form)">
                                    <span class="glyphicon {{format.glyph}} data-format-list-item-glyph"></span>
                                    <span class="data-format-list-item-text">{{format.name}}</span>                                                            
                                </li>
                            </ul>
                        </tab>
                    </tabset>
                </div>
            </div>
        </div>
        <div class="layout-row"></div>


        <div class="row">

            <div class="col-md-9">

                <!-- keywords -->
                        

                <div class="editor-keywords form-group">
                    <span ng-repeat="k in form.gemini.keywords" tc-tag tc-tag-delete>
                        <span ng-style="{ 'background-color': hashStringToColor(k.vocab) }">&nbsp;</span>
                        {{ k.value }}
                    </span>
                    
                    <button class="btn btn-sm btn-dialogue" tc-tip title="Edit tags (keywords)"
                            ng-click="keywordEditorOpen = !keywordEditorOpen">&bull;&bull;&bull;</button>                    
                </div>
                
                <div ng-show="keywordEditorOpen" class="editor-keywords-editor form-inline">
                    <div ng-repeat="k in form.gemini.keywords">
                        <input type="text" ng-model="k.vocab" placeholder="Vocab (namespace)" class="form-control" style="width:55%" />
                        <input type="text" ng-model="k.value" placeholder="Value (keyword)" class="form-control" style="width:35%" />
                        <button class="btn btn-sm btn-primary" ng-click="removeKeyword(k)">
                            <span style="font-size: small" class="glyphicon glyphicon-remove-sign"></span>
                        </button>
                    </div>
                    <button class="btn btn-primary icon-and-text-btn" ng-click="addKeyword()">
                        <span class="glyphicon glyphicon-plus-sign"></span>
                        NEW
                    </button>
                </div>
                
                <!-- abstract -->
                <div class="editor-abstract form-group">
                    <label for="abstractArea">Abstract</label>
                    <textarea id="abstractArea" type="text" ng-model="form.gemini.abstract" class="form-control"
                              rows="2"
                              placeholder="Abstract"
                              title="The abstract is a clear, brief summary of the resource's content"
                              tc-focus-tip tc-autosize></textarea>
                </div>

                <div class="form-horizontal form-group">
                    <div class="row">
                        <label for="temporalExtentDiv" class="col-md-2 control-label">Temporal Extent</label>
                        
                        <div id="temporalExtentDiv" class="col-md-3 input-group">
                            <input type="text" class="form-control"
                                   name="gemini.temporalExtent.begin" 
                                   ng-model="form.gemini.temporalExtent.begin"
                                   placeholder="yyyy-mm-dd"
                                   datepicker-popup="yyyy-MM-dd"
                                   tc-focus-tip 
                                   is-open="extentBegin"
                                   close-text="Close"
                                   ng-click="open($event,'extentBegin')"
                                   title="The dates covered by the data resource" />
                            <span class="input-group-addon" ng-click="open($event,'extentBegin')">
                                <span class="dark glyphicon glyphicon-calendar"></span>
                            </span>
                        </div>
                        <div class="col-md-1">
                            <span class="glyphicon glyphicon-chevron-right" style="margin-left: 1em;padding-top: 5px;"></span>
                        </div>
                        <div class="col-md-3 input-group">
                            <input type="text" class="form-control"
                                   name="gemini.temporalExtent.end" 
                                   ng-model="form.gemini.temporalExtent.end"
                                   placeholder="yyyy-mm-dd"
                                   datepicker-popup="yyyy-MM-dd"
                                   tc-focus-tip 
                                   is-open="extentEnd"
                                   close-text="Close"
                                   ng-click="open($event,'extentEnd')"
                                   title="The dates covered by the data resource" />
                            <span class="input-group-addon" ng-click="open($event,'extentEnd')">
                                <span class="dark glyphicon glyphicon-calendar"></span>
                            </span>
                        </div>
                    </div>
                    <div class="col-md-2"></div>
                </div>

                <div class="form-horizontal">
                    <div class="form-group">
                        <label for="datasetReferenceDateDiv" class="col-md-2">Dataset Reference Date</label>
                        <div id="datasetReferenceDateDiv">
                            <div class="col-md-3 input-group">
                                <input type="text" class="form-control"
                                       name="gemini.datasetReferenceDate" 
                                       ng-model="form.gemini.datasetReferenceDate"
                                       placeholder="yyyy-mm-dd"
                                       datepicker-popup="yyyy-MM-dd"
                                       tc-focus-tip 
                                       is-open="datasetReferenceDate"
                                       close-text="Close"
                                       ng-click="open($event,'datasetReferenceDate')"
                                       title="The dates covered by the data resource" />
                                <span class="input-group-addon" ng-click="open($event,'datasetReferenceDate')">
                                    <span class="dark glyphicon glyphicon-calendar"></span>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>

                <!--                <div class="well well-sm">-->
                <!---->
                <!--                    <div ng-repeat="contact in form.contacts" ng-animate=" 'animate' " class="form-inline form-group">-->
                <!--                        <select ng-model="contact.type" class="form-control" style="width: 140px">-->
                <!--                            <option>email</option>-->
                <!--                            <option>phone</option>-->
                <!--                            <option>pager</option>-->
                <!--                            <option>IM</option>-->
                <!--                        </select>-->
                <!--                        <input type="text" ng-model="contact.value" required placeholder="go on, go on" class="form-control" style="width: 140px" />-->
                <!--                        <a ng-click="removeContact(contact)" class="btn btn-primary">X</a>-->
                <!--                    </div>-->
                <!---->
                <!--                    <a ng-click="addContact()" class="btn btn-primary">ADD</a>-->
                <!---->
                <!--                </div>-->
                
                
                <div class="form-horizontal">
                    <div class="form-group">
                        <label for="categoryDiv" class="col-md-2 control-label">Topic Category</label>
                        <div id="categoryDiv" class="col-md-10">
                            <select
                                data-ng-model="form.gemini.topicCategory"
                                data-ng-options="topic.key as topic.key|camelCaseFilter for topic in lookups.topics"
                                class="form-control"
                                title="The main theme of the data resource">
                                <option value="" disabled selected style="display: none">Topic</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="form-horizontal">
                    <div class="form-group">
                        <label for="resourceLocatorDiv" class="col-md-2 control-label">Resource Locator</label>
                        <div id="resourceLocatorDiv" class="col-md-10 input-group">
                            <input name="resourceLocator" ng-model="form.gemini.resourceLocator" 
                                   type="text" class="form-control" 
                                   placeholder="Published Resource Location"
                                   tc-focus-tip title="Location (Address) for on-line access using a Uniform Resource Locator (URL) address or similar addressing scheme"
                                   spellcheck="false" />
                        
                            <a href="{{form.gemini.resourceLocator}}" target="_blank" class="input-group-addon pointable">
                                <span class="dark glyphicon glyphicon-folder-open" title="Go to resource" tc-focus-tip></span>
                            </a>
                        </div>
                    </div>
                </div>
                
                <hr />
                
                <div class="editor-abstract form-group">
                    <label for="lineageArea">Lineage</label>
                    <textarea id="Textarea1" type="text" ng-model="form.gemini.lineage" class="form-control"
                              rows="2"
                              placeholder="Lineage"
                              title="Information about the events or source data used in the construction of the data resource"
                              tc-focus-tip tc-autosize></textarea>
                </div>
                <div class="editor-abstract form-group">
                    <label for="publicAccessArea">Limitations on Public Access</label>
                    <textarea id="publicAccessArea" type="text" ng-model="form.gemini.limitationsOnPublicAccess" class="form-control"
                              rows="2"
                              placeholder="no limitations"
                              title="Restrictions imposed on the data resource for security and other reasons"
                              tc-focus-tip tc-autosize></textarea>
                </div>
                <div class="editor-abstract form-group">
                    <label for="useConstraintsArea">Use Constraints</label>
                    <textarea id="useConstraintsArea" type="text" ng-model="form.gemini.useConstraints" class="form-control"
                              rows="2"
                              placeholder="no conditions apply"
                              title="Restrictions and legal restraints on using the data resource"
                              tc-focus-tip tc-autosize></textarea>
                </div>
                
                <hr/>
                
                <div>
                    <label for="responsibleOrgDiv">Responsible Organisation</label>
                    <div id="responsibleOrgDiv" class="form-horizontal">
                        <div class="form-group">
                            <label for="responsibleOrgNameDiv" class="col-md-1 control-label">Name</label>
                            <div id="responsibleOrgNameDiv" class="col-sm-11">
                                <input class="form-control" type="text" ng-model="form.gemini.responsibleOrganisation.name" placeholder="Responsible Organisation Name" title="The name of the organisation responsible for this resource" tc-focus-tip />
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="responsibleOrgEmailDiv" class="col-md-1 control-label">Email</label>
                            <div id="responsibleOrgEmailDiv" class="col-sm-11">
                                <input class="form-control" type="text" ng-model="form.gemini.responsibleOrganisation.email" placeholder="Responsible Organisation Email" title="An email for the point of contact in this responsible organisation" tc-focus-tip />
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="responsibleOrgRoleDiv" class="col-md-1 control-label">Role</label>
                            <div id="responsibleOrgRoleDiv" class="col-sm-11">
<!--                                <select-->
<!--                                    data-ng-model="form.gemini.responsibleOrganisation.role"-->
<!--                                    data-ng-options="role as role|camelCaseFilter for role in lookups.roles"-->
<!--                                    class="form-control"-->
<!--                                    title="The role of the responsible organisation with this resource"-->
<!--                                    tc-focus-tip>-->
<!--                                    <option value="" disabled selected style="display: none">Responsible Organisation Role</option>-->
<!--                                </select>-->
                            </div>
                        </div>
                    </div>
                </div>
                
                <hr/>

                <div>
                    <label for="metadataPointOfContactDiv">Metadata Point of Contact</label>
                    <div id="metadataPointOfContactDiv" class="form-horizontal">
                        <div class="form-group">
                            <label for="metadataPointofContactNameDiv" class="col-md-1 control-label">Name</label>
                            <div id="metadataPointofContactNameDiv" class="col-md-11">
                                <input class="form-control" type="text" ng-model="form.gemini.metadataPointOfContact.name" placeholder="Metadata Point of Contact Name" title="The name of the point of contact responsible for this metadata" tc-focus-tip />
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="metadataPointofContactEmailDiv" class="col-md-1 control-label">Email</label>
                            <div id="metadataPointofContactEmailDiv" class="col-md-11">
                                <input class="form-control" type="text" ng-model="form.gemini.metadataPointOfContact.email" placeholder="Metadata Point of Contact Email" title="An email for the point of contact for this metadata" tc-focus-tip />
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="metadataPointofContactRoleDiv" class="col-md-1 control-label">Role</label>
                            <div id="metadataPointofContactRoleDiv" class="col-md-11">
<!--                                <select-->
<!--                                    data-ng-model="form.gemini.metadataPointOfContact.role"-->
<!--                                    data-ng-options="role as role|camelCaseFilter for role in lookups.roles"-->
<!--                                    class="form-control"-->
<!--                                    title="The role of the point of contact for this metadata"-->
<!--                                    tc-focus-tip>-->
<!--                                    <option value="" disabled selected style="display: none">Metadata Point of Contact Role</option>-->
<!--                                </select>    -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <hr />               
                <div class="row">
                    <div class="form-horizontal">
                        <label for="resourceTypeDiv" class="col-md-2 control-label" style="text-align:left">Resource Type</label>
                        <div id="resourceTypeDiv" class="col-md-10">
                            <input class="form-control" type="text" ng-model="form.gemini.resourceType" placeholder="Type of Resource" title="The type of resource described by this metadata" tc-focus-tip />
                        </div>
                    </div>
                </div>
                
                <hr />

                <div>
                    <label for="spatialDataDiv">Spatial Data</label>
                    <div id="spatialDataDiv">
                        <div id="extent">
                            <div class="editor-keywords form-group">
                                <span ng-repeat="extent in form.gemini.extent">
                                    <span ng-style="{ 'background-color': hashStringToColor(extent.authority) }">&nbsp;</span>
                                    {{ extent.authority }} - {{ extent.code }}
                                </span>
                    
                                <button class="btn btn-sm btn-dialogue" tc-tip title="Edit Extents"
                                        ng-click="extentEditorOpen = !extentEditorOpen">&bull;&bull;&bull;</button>                    
                            </div>
                
                            <div ng-show="extentEditorOpen" class="editor-keywords-editor form-inline">
                                <div ng-repeat="extent in form.gemini.extent">
                                    <input type="text" ng-model="extent.authority" placeholder="Authority (optional)" class="form-control" style="width:40%" />
                                    <input type="text" ng-model="extent.code" placeholder="Extent Identification Code" class="form-control" style="width:40%" />
                                    <button class="btn btn-sm btn-primary" ng-click="removeExtent(extent)">
                                        <span style="font-size: small" class="glyphicon glyphicon-remove-sign"></span>
                                    </button>
                                </div>
                                <button class="btn btn-primary icon-and-text-btn" ng-click="addExtent()">
                                    <span class="glyphicon glyphicon-plus-sign"></span>
                                    NEW
                                </button>
                            </div>                                
                        </div>
                        
                        <div class="layout-row form-horizontal">
                            <label for="spatialReferenceDiv" class="col-md-3 control-label" style="padding-left:0; text-align:left;">Spatial Refrence System</label>
                            <div id="spatialReferenceDiv" class="col-md-9" style="padding-left:0; padding-right:0;">
                                <input class="form-control" type="text" ng-model="form.gemini.spatialReferenceSystem" title="Identifier of the system of spatial referencing, whether by coordiantes or geographic identifiers used in the data resource" tc-focus-tip />
                            </div>
                        </div>
                        
                        <div>
                            <label for="boundingBoxDiv">Bounding Box</label>
                            <div id="boundingBoxDiv" class="form-horizontal">
                                <div class="form-horizontal">
                                    <div class="col-md-6">
                                        <label for="boundingBoxNorthDiv" class="col-md-2 control-label">North</label>
                                        <div id="boundingBoxNorthDiv" class="col-md-10">
                                            <input class="form-control" type="text" ng-model="form.gemini.boundingBox.north" />
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="boundingBoxSouthDiv" class="col-md-2 control-label">South</label>
                                        <div id="boundingBoxSouthDiv" class="col-md-10">
                                            <input class="form-control" type="text" ng-model="form.gemini.boundingBox.south" />
                                        </div>
                                    </div>
                                    <br /><br />
                                    <div class="col-md-6">
                                        <label for="boundingBoxEastDiv" class="col-md-2 control-label">East</label>
                                        <div id="boundingBoxEastDiv" class="col-md-10">
                                            <input class="form-control" type="text" ng-model="form.gemini.boundingBox.east" />
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="boundingBoxWestDiv" class="col-md-2 control-label">West</label>
                                        <div id="boundingBoxWestDiv" class="col-md-10">
                                            <input class="form-control" type="text" ng-model="form.gemini.boundingBox.west" />
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <button ng-click="cancel()" ng-hide="isCancelHidden()" class="btn btn-primary">CANCEL</button>
                    <button ng-click="save()"  ng-hide="isSaveHidden()" ng-disabled="isSaveDisabled()" class="btn btn-danger">SAVE</button>
                </div>

            </div>

            <div class="col-md-3">
                <div class="editor-internal well well-sm">
                    

                    <div class="editor-top-copy layout-row">
                        <div class="layout-col">
                            <span>Top copy</span>
                        </div>
                        <div class="layout-col pull-right">
                            <div class="btn-group">
                                <!-- omg angular ! -->
                                <button ng-click="form.topCopy = true" ng-class="{ 'btn-primary': form.topCopy, 'btn-default': !form.topCopy }" class="btn">
                                    <span class="glyphicon glyphicon-leaf"></span>Yes
                                </button>
                                <button ng-click="form.topCopy = false" ng-class="{ 'btn-primary': !form.topCopy, 'btn-default': form.topCopy  }" class="btn">
                                    No
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <hr />

                    <div class="editor-validation layout-row">
                        <div class="layout-col">
                            <span>Validation</span>
                        </div>
                        <div class="layout-col pull-right">
                            
                            <button type="button" class="btn btn-default"
                                 ng-click="form.validation = (form.validation + 1) % 2"
                                ng-class="{ 'btn-default': form.validation == 0, 'btn-success': form.validation == 1}"
                                    title="The level of validation to perform on the record"
                                    tc-tip
                                >
                                <span class="dark glyphicon glyphicon-repeat"></span>
                                {{form.validation == 1 ? 'Gemini':'Basic';}}
                            </button>

                        </div>
                    </div>

                    <hr />

                    <div class="editor-security layout-row">
                        <div class="layout-col">
                            <span>Security</span>
                        </div>
                        <div class="layout-col pull-right">
                            
                            <button type="button" class="btn"
                                    ng-click="form.security = (form.security + 1) % 3"
                                    ng-class="{ 'btn-default': form.security == 0, 'btn-warning': form.security == 1, 'btn-danger': form.security == 2  }"
                                    title="The resource's security level"
                                    tc-tip
                                >
                                <span class="glyphicon glyphicon-repeat" ng-class="{ 'dark': form.status == 0 }"></span>
                                {{ getSecurityText(form.security) }}
                            </button>

                        </div>
                    </div>

                    <hr />
                    <div class="editor-status layout-row">
                        <div class="layout-col">
                            <span>Status</span>
                        </div>
                        <div class="layout-col pull-right">
                            
                            <button type="button" class="btn"
                                ng-click="form.status = (form.status + 1) % 2"
                                ng-class="{ 'btn-default': form.status == 0, 'btn-success': form.status == 1 }"
                                title="Is the resource for internal use only, or is it for publishing externally?"
                                tc-tip
                                >
                                <span class="glyphicon glyphicon-repeat" ng-class="{ 'dark': form.status == 0 }"></span>
                                {{ form.status == 0 ? 'Internal' : 'Publishable' }}
                            </button>

                        </div>
                    </div>

                    <hr />
                    
                    <div class="editor-review layout-row">
                        <div class="layout-col">
                            <span>Review</span>
                        </div>
                        <div class="layout-col pull-right">
                           <div class="input-group date-container hackyhack">
                                <input type="text" class="form-control"
                                       name="gemini.temporalExtent.end" 
                                       ng-model="form.review"
                                       placeholder="yyyy-mm-dd"
                                       datepicker-popup="yyyy-MM-dd"
                                       tc-focus-tip 
                                       is-open="review"
                                       close-text="Close"
                                       ng-click="open($event,'review')"
                                       title="The date for reviewing this record" />
                                <span class="input-group-addon" ng-click="open($event,'review')">
                                    <span class="dark glyphicon glyphicon-calendar"></span>
                                </span>
                            </div>
                        </div>
                    </div>

                    <hr />

                    <div class="editor-notes form-group">
                        <textarea ng-model="form.notes" type="text" rows="4"
                            tc-autosize
                            class="form-control"
                            placeholder="Notes"
                            title="Notes to keep separate from the Gemini record"
                            tc-focus-tip></textarea>
                    </div>
                    
                </div>

            </div>
            
            {{form}}
        </div>
    </form>
</div>
