(function(){angular.module("app.controllers").controller("SearchController",function(t,i,r,u,f){var e,s,o;return e="Topcat:",s=function(n,t){return n.indexOf(t,n.length-t.length)!==-1?n:n.concat(t)},t.searchType={fulltext:"fulltext",keyword:"keyword"},t.activeSearchType=t.searchType.fulltext,t.keyword="",t.query={q:r.search().q||"",k:[r.search().k||""],p:0,n:25},t.query.k[0]!==""&&(t.activeSearchType=t.searchType.keyword),t.app={starting:!0},f(function(){return t.app.starting=!1},500),t.range=function(n,t,i){var u,e,r,f;for(i=i===void 0?1:i,e=[],f=[],u=r=0;0<=t?r<=t:r>=t;u=r+=i)f.push(e.push(u));return f},t.maxPages=function(n,t){return Math.ceil(n/t)-1},i.page={title:e},t.tagSearch=function(n){return t.query.p="",t.query.k=[o(n)],t.doSearch()},t.getKeywords=function(n){return u.get("../api/keywords?q="+n).then(function(n){return n.data})},t.doSearch=function(){var n;if(t.query.q||t.query.k[0])return r.url(r.path()),r.search("q",t.query.q),r.search("k",t.query.k[0]),r.search("p",t.query.p),r.search("n",t.query.n),i.page={title:e+t.query.q},t.busy.start(),n="../api/search?"+$.param(t.query),u.get(n).success(function(n){if(angular.equals(n.query,t.query))return t.result=n.total===0?{}:n})["finally"](function(){return t.busy.stop()})},o=function(n){var t;return t=s(n.vocab,"/")+n.value,t.replace("http://","")},t.onKeywordSelect=function(n){return t.query.k=[o(n)],t.doSearch()},t.switchSearchType=function(){return t.activeSearchType===t.searchType.keyword?t.query.q="":t.activeSearchType===t.searchType.fulltext?t.query.k=[""]:void 0},t.nextPage=function(){return t.query.p=n-1,t.doSearch()}})}).call(this)