(function(){var n=[].indexOf||function(n){for(var t=0,i=this.length;t<i;t++)if(t in this&&this[t]===n)return t;return-1};angular.module("app.controllers").controller("SearchController",function(t,i,r,u,f,e){var o,s,h,c,l;return t.app={starting:!0},f(function(){return t.app.starting=!1},500),t.result={results:{}},t.resultsView="list",l=function(n){var t;return t=o(),r.search("q",n.q||null),r.search("k",n.k),r.search("p",n.p||null)},c=function(n){return u.get("../api/search?"+$.param(n,!0)).success(function(i){return console.log(n),console.log(i.query),angular.equals(i.query,n)?t.result=i:void 0}).error(function(n){return t.notifications.add("Oops! "+n.message)})},h=function(n){return n.q?u.get("../api/keywords?q="+n.q).success(function(n){return t.keywordSuggestions=n}).error(function(n){return t.notifications.add("Oops! "+n.message)}):e.defer()},t.doSearch=function(n){var i,r;return l(n),n.q||n.k[0]?(t.busy.start(),i=h(n),r=c(n),e.all([i,r])["finally"](function(){return t.busy.stop(),t.result.query.q?void 0:t.keywordSuggestions={}})):(t.keywordSuggestions={},t.result={})},o=function(){return{q:"",k:[],p:0,n:15}},s=function(){var n;return n=r.search(),n.k&&!$.isArray(n.k)&&(n.k=[n.k]),n.p&&(n.p=n.p*1),$.extend({},o(),n)},t.query=s(),t.$watch("query",t.doSearch,!0),t.querystring=function(){return $.param(t.query,!0)},t.addKeywordToQuery=function(i){var r,u;return u=t.keywordToString(i),n.call(t.query.k,u)>=0?t.notifications.add("Your query already contains this keyword"):(r=t.query.k,r.push(u),t.query=$.extend({},o(),{k:r}))},t.removeKeywordFromQuery=function(n){return t.query.k.splice($.inArray(n,t.query.k),1)},t.keywordToString=function(n){var t;return t=n.vocab?n.vocab+"/"+n.value:n.value,t.replace("http://","")},t.keywordFromString=function(n){var t;return n.indexOf("/")===-1?{vocab:"",value:n}:(t=n.lastIndexOf("/"),{vocab:"http://"+n.substring(0,t),value:n.substring(t+1)})},t.setPage=function(n){return t.query.p=n-1},t.range=function(n,t,i){var u,e,r,f;for(i=i===void 0?1:i,e=[],f=[],u=r=0;i>0?r<=t:r>=t;u=r+=i)f.push(e.push(u));return f},t.maxPages=function(n,t){return Math.ceil(n/t)-1}})}).call(this);
//# sourceMappingURL=SearchController.min.js.map
