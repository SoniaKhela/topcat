(function(){var n=[].indexOf||function(n){for(var t=0,i=this.length;t<i;t++)if(t in this&&this[t]===n)return t;return-1};angular.module("app.controllers").controller("SearchController",function(t,i,r,u,f,e,o){var s,h,c,l,a;return t.vocabulator={},t.app={starting:!0},f(function(){return t.app.starting=!1},500),t.result={results:{}},t.pageSize=15,t.resultsView="list",a=function(n){var t;return t=s(),r.search("q",n.q||null),r.search("k",n.k),r.search("p",n.p||null)},l=function(n){return u.get("../api/search?"+$.param(n,!0)).success(function(i){if(angular.equals(i.query,n))return t.result=i}).error(function(n){return t.notifications.add("Oops! "+n.message)})},c=function(n){return n.q?u.get("../api/keywords?q="+n.q).success(function(n){return t.keywordSuggestions=n}).error(function(n){return t.notifications.add("Oops! "+n.message)}):e.defer()},t.doSearch=function(n){var i,r;return a(n),n.q||n.k[0]?(t.busy.start(),i=c(n),r=l(n),e.all([i,r])["finally"](function(){return t.busy.stop(),t.result.query.q?void 0:t.keywordSuggestions={}})):(t.keywordSuggestions={},t.result={})},s=function(){return{q:"",k:[],p:0,n:t.pageSize}},h=function(){var n;return n=r.search(),n.k&&!$.isArray(n.k)&&(n.k=[n.k]),n.p&&(n.p=n.p*1),$.extend({},s(),n)},t.query=h(),t.$watch("query",t.doSearch,!0),t.querystring=function(){return $.param(t.query,!0)},t.addKeywordToQuery=function(i){var r,u;return u=t.keywordToString(i),n.call(t.query.k,u)>=0?t.notifications.add("Your query already contains this keyword"):(r=t.query.k,r.push(u),t.query=$.extend({},s(),{k:r}))},t.removeKeywordFromQuery=function(n){return t.query.k.splice($.inArray(n,t.query.k),1)},t.keywordToString=function(n){var t;return t=n.vocab?n.vocab+"/"+n.value:n.value,t.replace("http://","")},t.keywordFromString=function(n){var t;return n.indexOf("/")===-1?{vocab:"",value:n}:(t=n.lastIndexOf("/"),{vocab:"http://"+n.substring(0,t),value:n.substring(t+1)})},t.openVocabulator=function(){var n;return n=o.open({controller:"VocabulatorController",templateUrl:"views/partials/vocabulator.html?"+(new Date).getTime(),size:"lg",scope:t}),n.result.then(function(n){return t.addKeywordToQuery(n)})},t.setPage=function(n){return console.log(n),n>0&&n<=t.maxPages(t.result.total,t.pageSize)+1?(console.log("setting value of p"),t.query.p=n-1):void 0},t.range=function(n,t,i){var u,e,r,f;for(i=i===void 0?1:i,e=[],f=[],u=r=0;i>0?r<=t:r>=t;u=r+=i)f.push(e.push(u));return f},t.maxPages=function(n,t){return Math.ceil(n/t)-1}})}).call(this);
//# sourceMappingURL=SearchController.min.js.map
