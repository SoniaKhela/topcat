(function(){angular.module("app.controllers").controller("SearchController",function(n,t,i,r,u){var f,o,s,e;return n.searchType={fulltext:"fulltext",keyword:"keyword"},n.activeSearchType=n.searchType.fulltext,n.keyword="",n.query={q:i.search().q||"",k:[i.search().k||""],p:0,n:25},e=function(n){var t;return t=o(n.vocab,"/")+n.value,t.replace("http://","")},s=function(n){var t,r,f,i,u,e;for(t=n.split("/"),f=t[t.length-1],i="http://",r=u=0,e=t.length-2;u<=e;r=u+=1)i=i.concat(t[r].concat("/"));return{value:f,vocab:i}},f="Topcat:",o=function(n,t){return n.indexOf(t,n.length-t.length)!==-1?n:n.concat(t)},n.app={starting:!0},u(function(){return n.app.starting=!1},500),n.range=function(n,t,i){var u,e,r,f;for(i=i===void 0?1:i,e=[],f=[],u=r=0;0<=t?r<=t:r>=t;u=r+=i)f.push(e.push(u));return f},n.maxPages=function(n,t){return Math.ceil(n/t)-1},t.page={title:f},n.tagSearch=function(t){return n.keyword=t,n.activeSearchType=n.searchType.keyword,n.query.q="",n.query.k=[e(t)],n.doSearch()},n.getKeywords=function(n){return r.get("../api/keywords?q="+n).then(function(n){return n.data})},n.doSearch=function(){var u;if(n.query.q||n.query.k[0])return i.url(i.path()),i.search("q",n.query.q),i.search("k",n.query.k[0]),i.search("p",n.query.p),i.search("n",n.query.n),t.page={title:f+n.query.q},n.busy.start(),u="../api/search?"+$.param(n.query),r.get(u).success(function(t){if(angular.equals(t.query,n.query))return n.result=t.total===0?{}:t})["finally"](function(){return n.busy.stop()})},n.onKeywordSelect=function(t){return n.query.k=[e(t)],n.doSearch()},n.switchSearchType=function(){return n.activeSearchType===n.searchType.keyword?n.query.q="":n.activeSearchType===n.searchType.fulltext?n.query.k=[""]:void 0},n.nextPage=function(t){return n.query.p=t-1,n.doSearch()},n.query.k[0]!==""&&(n.activeSearchType=n.searchType.keyword,n.keyword=s(n.query.k[0])),n.doSearch()})}).call(this)