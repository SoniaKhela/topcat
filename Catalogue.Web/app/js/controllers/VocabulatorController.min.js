(function(){var n=[].indexOf||function(n){for(var t=0,i=this.length;t<i;t++)if(t in this&&this[t]===n)return t;return-1};angular.module("app.controllers").controller("VocabulatorController",function(t,i,r){var f,e,o,u;return f=function(){return{q:"",allVocabs:[],filteredVocabs:[],selectedVocab:{},loadedVocab:{},foundKeywords:[],selectedKeywords:[],newUncontrolledKeyword:""}},t.vocabulator||(t.vocabulator={}),angular.equals({},t.vocabulator)&&angular.extend(t.vocabulator,f()),u=t.vocabulator,t.colourHasher=r,u.allVocabs.length||i.get("../api/vocabularylist").success(function(n){return u.allVocabs=n,u.filteredVocabs=n}),e=function(){return _.filter(u.selectedKeywords,function(n){return n.vocab!==""})},t.doFind=function(n,r){var f,o,s,h,c;return h=function(){return _(u.q.split(/[,;]+/)).map(function(n){return{vocab:"",value:n.trim()}}).filter(function(n){return n.value!==""}).value()},c=function(){if(!_.some(e())){if(n===""&&r!=="")return u.selectedKeywords=[];if(n!=="")return u.selectedKeywords=h(n)}},f=function(){return u.loadedVocab={},u.selectedVocab={}},s=function(){var i,t;return n=u.q.toLowerCase(),i=function(){var i,e,r,f;for(r=u.allVocabs,f=[],i=0,e=r.length;i<e;i++)t=r[i],t.name.toLowerCase().indexOf(n)!==-1&&f.push(t);return f}(),u.filteredVocabs=i},o=function(){return u.q===""?u.foundKeywords=[]:i.get("../api/keywords?q="+u.q).success(function(n){return u.foundKeywords=n}).error(function(n){return t.notifications.add("Oops! "+n.message)})},c(),n!==r?(f(),s(),o()):void 0},t.$watch("vocabulator.q",t.doFind),o=function(n,r){if(n&&n!==r)return i.get("../api/vocabularies?id="+encodeURIComponent(n.id)).success(function(n){return u.loadedVocab=n}).error(function(n){return t.notifications.add("Oops! "+n.message)})},t.$watch("vocabulator.selectedVocab",o),t.$watch("vocabulator.newUncontrolledKeyword",function(n,t){if(n!==""&&n!==t&&!_.some(e()))return u.selectedKeywords.length=0}),t.selectKeyword=function(t){return _.remove(u.selectedKeywords,function(n){return n.vocab===""}),n.call(u.selectedKeywords,t)<0?u.selectedKeywords.push(t):void 0},t.unselectKeyword=function(n){return u.selectedKeywords.splice(u.selectedKeywords.indexOf(n),1)},t.close=function(){var n;return n=u.selectedKeywords,angular.extend(t.vocabulator,f()),t.$close(n)}})}).call(this);
//# sourceMappingURL=VocabulatorController.min.js.map
