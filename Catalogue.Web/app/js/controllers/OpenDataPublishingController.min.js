(function(){var n=[].indexOf||function(n){for(var t=0,i=this.length;t<i;t++)if(t in this&&this[t]===n)return t;return-1};angular.module("app.controllers").controller("OpenDataPublishingController",function(t,i,r,u,f){var h,c,l,a,o,v,s,e;return e={tab:5,openData:{summary:{},list:[]}},t.m=e,t.signOffStatus={},t.recordTimeoutMap={},s=function(){return i.get("../api/publishing/opendata/summary").success(function(n){return e.openData.summary=n})},h=function(){return i.get("../api/publishing/opendata/publishedsincelastupdated").success(function(n){return e.openData.list=n})},c=function(){return i.get("../api/publishing/opendata/notpublishedsincelastupdated").success(function(n){return e.openData.list=n})},l=function(){return i.get("../api/publishing/opendata/publicationneverattempted").success(function(n){return e.openData.list=n})},a=function(){return i.get("../api/publishing/opendata/lastpublicationattemptwasunsuccessful").success(function(n){return e.openData.list=n})},o=function(){return i.get("../api/publishing/opendata/pendingsignoff").success(function(n){var u,i,f,r;for(e.openData.list=n,r=[],i=0,f=n.length;i<f;i++)u=n[i],r.push(t.signOffStatus[u.id]="Sign Off");return r})},v=function(){switch(e.tab){case 1:return h();case 2:return c();case 3:return l();case 4:return a();case 5:return o()}},t.$watch("m.tab",v),s(),o(),t.isIaoUser=n.call(t.user.groups.split(";"),f)>=0,t.submitSignOff=function(n){return t.signOffRequest={},t.signOffRequest.id=n,t.signOffRequest.comment="",i.put("../api/publishing/opendata/signoff",t.signOffRequest).success(function(){return t.signOffStatus[n]="Signed Off",s(),t.loadRecordsPendingSignOff(),t.notifications.add("Successfully signed off")})["catch"](function(i){return i.status===401?t.notifications.add("Unauthorised - not in valid sign off group"):t.notifications.add(i.data.exceptionMessage),t.signOffStatus[n]="Retry?",delete t.recordTimeoutMap[n]})},t.allowGraceTime=function(n){return t.recordTimeoutMap[n]>0?(t.signOffStatus[n]="Cancel "+("0"+t.recordTimeoutMap[n]--).slice(-2),u(t.allowGraceTime.bind(null,n),1e3)):n in t.recordTimeoutMap?t.submitSignOff(n):void 0},t.cancelSignOff=function(n){return delete t.recordTimeoutMap[n],t.signOffStatus[n]="Sign Off"},t.signOffButtonClick=function(n){return n in t.recordTimeoutMap?t.cancelSignOff(n):(t.recordTimeoutMap[n]=10,t.allowGraceTime(n))}})}).call(this);