(function(){angular.module("app.controllers").controller("OpenDataPublishingController",function(n,t,i,r){var o,s,h,c,f,l,e,u;return u={tab:5,openData:{summary:{},list:[]}},n.m=u,n.signOffStatus={},n.recordTimeoutMap={},e=function(){return t.get("../api/publishing/opendata/summary").success(function(n){return u.openData.summary=n})},o=function(){return t.get("../api/publishing/opendata/publishedsincelastupdated").success(function(n){return u.openData.list=n})},s=function(){return t.get("../api/publishing/opendata/notpublishedsincelastupdated").success(function(n){return u.openData.list=n})},h=function(){return t.get("../api/publishing/opendata/publicationneverattempted").success(function(n){return u.openData.list=n})},c=function(){return t.get("../api/publishing/opendata/lastpublicationattemptwasunsuccessful").success(function(n){return u.openData.list=n})},f=function(){return t.get("../api/publishing/opendata/pendingsignoff").success(function(t){var f,i,e,r;for(u.openData.list=t,r=[],i=0,e=t.length;i<e;i++)f=t[i],r.push(n.signOffStatus[f.id]="Sign Off");return r})},l=function(){switch(u.tab){case 1:return o();case 2:return s();case 3:return h();case 4:return c();case 5:return f()}},n.$watch("m.tab",l),e(),f(),n.submitSignOff=function(i){return n.signOffRequest={},n.signOffRequest.id=i,n.signOffRequest.comment="",t.put("../api/publishing/opendata/signoff",n.signOffRequest).success(function(){return n.signOffStatus[i]="Signed Off",e(),n.loadRecordsPendingSignOff(),n.notifications.add("Successfully signed off")})["catch"](function(t){return t.status===401?n.notifications.add("Unauthorised - not in valid sign off group"):n.notifications.add(t.data.exceptionMessage),n.signOffStatus[i]="Retry?",delete n.recordTimeoutMap[i]})},n.allowGraceTime=function(t){return n.recordTimeoutMap[t]>0?(n.signOffStatus[t]="Cancel "+("0"+n.recordTimeoutMap[t]--).slice(-2),r(n.allowGraceTime.bind(null,t),1e3)):t in n.recordTimeoutMap?n.submitSignOff(t):void 0},n.cancelSignOff=function(t){return delete n.recordTimeoutMap[t],n.signOffStatus[t]="Sign Off"},n.signOffButtonClick=function(t){return t in n.recordTimeoutMap?n.cancelSignOff(t):(n.recordTimeoutMap[t]=10,n.allowGraceTime(t))}})}).call(this);