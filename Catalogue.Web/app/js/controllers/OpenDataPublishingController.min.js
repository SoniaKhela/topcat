(function(){angular.module("app.controllers").controller("OpenDataPublishingController",function(n,t,i,r){var o,f,s,h,c,l,e,u;return u={tab:5,openData:{summary:{},list:[]},signOffStatus:{},signOffTimeoutMap:{}},n.m=u,f=function(){return t.get("../api/publishing/opendata/summary").success(function(n){return u.openData.summary=n})},s=function(){return t.get("../api/publishing/opendata/publishedsincelastupdated").success(function(n){return u.openData.list=n})},h=function(){return t.get("../api/publishing/opendata/notpublishedsincelastupdated").success(function(n){return u.openData.list=n})},c=function(){return t.get("../api/publishing/opendata/publicationneverattempted").success(function(n){return u.openData.list=n})},l=function(){return t.get("../api/publishing/opendata/lastpublicationattemptwasunsuccessful").success(function(n){return u.openData.list=n})},e=function(){return t.get("../api/publishing/opendata/pendingsignoff").success(function(n){var r,t,f,i;for(u.openData.list=n,i=[],t=0,f=n.length;t<f;t++)r=n[t],i.push(u.signOffStatus[r.id]="Sign Off");return i})},o=function(){switch(u.tab){case 1:return s();case 2:return h();case 3:return c();case 4:return l();case 5:return e()}},n.$watch("m.tab",o),f(),e(),n.submitSignOff=function(i){return n.signOffRequest={id:i,comment:""},t.put("../api/publishing/opendata/signoff",n.signOffRequest).success(function(){return u.signOffStatus[i]="Signed Off",f(),n.notifications.add("Successfully signed off"),n.status.refresh()})["catch"](function(t){return t.status===401?n.notifications.add("Unauthorised - not in valid sign off group"):n.notifications.add(t.data.exceptionMessage),u.signOffStatus[i]="Retry?",delete u.signOffTimeoutMap[i]})},n.allowGraceTime=function(t){return u.signOffTimeoutMap[t]>0?(u.signOffStatus[t]="Cancel "+("0"+u.signOffTimeoutMap[t]--).slice(-2),r(n.allowGraceTime.bind(null,t),1e3)):t in u.signOffTimeoutMap?n.submitSignOff(t):void 0},n.cancelSignOff=function(n){return delete u.signOffTimeoutMap[n],u.signOffStatus[n]="Sign Off"},n.signOffButtonClick=function(t){return t in u.signOffTimeoutMap?n.cancelSignOff(t):(u.signOffTimeoutMap[t]=10,n.allowGraceTime(t))}})}).call(this);