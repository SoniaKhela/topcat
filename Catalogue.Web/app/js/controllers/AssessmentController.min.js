(function(){angular.module("app.controllers").controller("AssessmentController",function(n,t){var r,i,u,f;return r=function(n){var t,i,r;return r=n.getFullYear(),i=f(n.getMonth()+1),t=f(n.getDate()),""+t+"/"+i+"/"+r},f=function(n){return n<10?"0"+n:n},n.assessmentRequest={},n.assessmentRequest.id=n.form.id,i={riskAssessment:{currentClass:{},completed:{}},signOff:{currentClass:{},completed:{}},upload:{currentClass:{},completed:{}},currentActiveView:{},signOffButtonDisabled:!n.user.isIaoUser||n.form.publication!==null&&n.form.publication.openData.signOff!==null},n.publishingStatus=i,n.refreshPublishingStatus=function(t){return i.currentActiveView=t,i.riskAssessment.completed=n.form.publication!==null&&n.form.publication.openData.assessment.completed,i.signOff.completed=n.form.publication.openData.signOff!==null,i.upload.completed=n.form.publication.openData.lastSuccess!==null,t==="risk assessment"?(i.riskAssessment.currentClass=i.signOff.completed?"visited":"current",i.signOff.currentClass=i.signOff.completed?"current":"",i.upload.currentClass="",console.log("refreshing publishing status "+t+" current class "+i.riskAssessment.currentClass)):t==="sign off"?(console.log("refreshing publishing status "+t),i.riskAssessment.currentClass="visited",i.signOff.currentClass="current",i.upload.currentClass=""):(i.riskAssessment.currentClass="visited",i.signOff.currentClass="visited",i.upload.currentClass="current")},n.refreshPublishingStatus("risk assessment"),u=function(){return n.assessmentButtonText=n.form.publication!==null&&n.form.publication.openData.assessment.completed?n.form.publication.openData.assessment.initialAssessmentWasDoneOnSpreadsheet?"Initial assessment completed on spreadsheet":"Completed by "+n.form.publication.openData.assessment.completedByUser.displayName+" on "+r(new Date(n.form.publication.openData.assessment.completedOnUtc)):"I AGREE"},u(),n.signOffButtonText=n.form.publication!==null&&n.form.publication.openData.signOff!==null?"Signed off by "+n.form.publication.openData.signOff.user.displayName+" on "+r(new Date(n.form.publication.openData.signOff.dateUtc)):n.user.isIaoUser?"SIGN OFF":"Pending sign off",n.assessClick=function(){return t.put("../api/publishing/opendata/assess",n.assessmentRequest).success(function(t){return n.status.refresh(),n.expandSignOff(),n.form=t.record,u()})["catch"](function(t){return n.notifications.add(t.data.exceptionMessage),n.$dismiss()})},n.nextStep=function(){return i.riskAssessment.currentClass==="current"?n.refreshPublishingStatus("sign off"):i.signOff.currentClass==="current"&&scope.refreshPublishingStatus("upload"),console.log("Show assessment: "+n.showAssessmentView+", show sign off: "+n.showSignOffView)},n.close=function(){return n.$close(n.form)}})}).call(this);