(function(){var o,n,i,r,u,f,t,e;angular.module("app.controllers").controller("EditorController",function(o,s,h,c,l,a){return o.editing={},o.lookups={},o.lookups.currentDataFormat={},o.recordOutput=l,o.vocabulator={},o.$=$,s.get("../api/topics").success(function(n){return o.lookups.topics=n}),s.get("../api/formats?q=").success(function(t){return o.lookups.currentDataFormat=n(o.form.gemini.dataFormat,t),o.lookups.formats=t}),s.get("../api/roles?q=").success(function(n){return o.lookups.roles=n}),o.collapseDataFormatSelector=!0,o.collapseDateFormat=!0,o.getSecurityText=f,o.getDataFormatObj=n,o.updateDataFormatObj=e,o.getPendingSignOff=u,o.getOpenDataButtonText=i,o.getOpenDataButtonToolTip=r,o.cancel=function(){return o.reset(),o.lookups.currentDataFormat=n(o.form.gemini.dataFormat,o.lookups.formats),o.notifications.add("Edits cancelled")},o.open=function(n,t){n.preventDefault();n.stopPropagation();o[t]=!0},o.successResponse=function(n){return o.reloadRecord(n),o.notifications.add("Edits saved")},o.reloadRecord=function(n){return o.recordOutput={record:n.record,recordState:n.recordState},o.validation={},o.reset(),o.status.refresh(),c.path("/editor/"+o.recordOutput.record.id)},o.save=function(){var n;return n=function(n){var f,t,e,i,r,s,h,u;if(n.data.success)o.successResponse(n.data);else if(o.validation=n.data.validation,t=n.data.validation.errors,t.length>0)for(o.notifications.add("There were errors"),i=0,s=t.length;i<s;i++)for(f=t[i],u=f.fields,r=0,h=u.length;r<h;r++){e=u[r];try{o.theForm[e].$setValidity("server",!1)}catch(c){}}return o.busy.stop()},o.busy.start(),o.isNew()?s.post("../api/records",o.form).then(n):s.put("../api/records/"+o.recordOutput.record.id,o.form).then(n)},o.clone=function(){return c.path("/clone/"+o.form.id)},o.reset=function(){return o.form=angular.copy(o.recordOutput.record)},o.isNew=function(){return o.form.id==="00000000-0000-0000-0000-000000000000"},o.isClean=function(){return angular.equals(o.form,o.recordOutput.record)},o.isSaveHidden=function(){return o.isClean()||o.recordOutput.record.readOnly},o.isCancelHidden=function(){return o.isClean()},o.isSaveDisabled=function(){return o.isClean()},o.isCloneHidden=function(){return o.isNew()},o.isCloneDisabled=function(){return!o.isClean()},o.isHttpPath=function(n){return n.toLowerCase().startsWith("http")},o.isPublishingModalButtonEnabled=function(){return t(o.form.path)&&o.isSaveHidden()},o.hasUsageConstraints=function(){return!!o.form.gemini.limitationsOnPublicAccess&&o.form.gemini.limitationsOnPublicAccess!=="no limitations"||!!o.form.gemini.useConstraints&&o.form.gemini.useConstraints!=="no conditions apply"},o.removeKeyword=function(n){return o.form.gemini.keywords.splice($.inArray(n,o.form.gemini.keywords),1)},o.addKeywords=function(n){var r,t,u,i;for(i=[],t=0,u=n.length;t<u;t++)r=n[t],i.push(o.form.gemini.keywords.push(r));return i},o.editKeywords=function(){var n;return n=a.open({controller:"VocabulatorController",templateUrl:"views/partials/vocabulator.html?"+(new Date).getTime(),size:"lg",scope:o}),n.result.then(function(n){return o.addKeywords(n)})["finally"](function(){return o.editing.keywords=!0})},o.editAbstract=function(){var n;return n=a.open({controller:"MarkdownController",templateUrl:"views/partials/markdown.html?"+(new Date).getTime(),size:"lg",resolve:{markdown:function(){return o.form.gemini.abstract}}}),n.result.then(function(n){return o.form.gemini.abstract=n})},o.openPublishingModal=function(){var n;return n=a.open({controller:"OpenDataModalController",templateUrl:"views/partials/opendatamodal.html?"+(new Date).getTime(),size:"lg",scope:o,resolve:{recordOutput:function(){return o.recordOutput}},backdrop:"static"}),n.result.then(function(n){return o.reloadRecord(n)})},o.removeExtent=function(n){return o.form.gemini.extent.splice($.inArray(n,o.form.gemini.extent),1)},o.addExtent=function(){return o.form.gemini.extent===null&&(o.form.gemini.extent=[]),o.form.gemini.extent.push({authority:"",code:""})},o.reset(),o.getKeywords=function(n){return s.get("../api/keywords?q="+n).then(function(n){return n.data})},o.setKeyword=function(n,t){return t.vocab=n.vocab}});t=function(n){return n.match(/^([a-z]:|\\\\jncc-corpfile\\)/i)};r=function(n,i){return t(n.path)?n.publication===null?"The open data publication status of the record, editing the record may affect the status.":n.publication.openData.lastSuccess===null||i.assessedAndUpToDate?"The open data publication status of the record, editing the record may affect the status.":"This record has been changed since it was last published, it may need republishing.":"Open data publishing not available for non-file resources"};i=function(n,t){return n.publication===null?"Not Open Data":n.publication.openData.lastSuccess===null||t.assessedAndUpToDate?t.uploadedAndUpToDate?"Published":t.signedOffAndUpToDate?"Signed Off":t.assessedAndUpToDate?"Assessed":"Not Open Data":"Republish"};u=function(n){return n!==null&&n.openData.assessment.completed&&n.openData.signOff===null?!0:!1};f=function(n){switch(n){case 0:return"Official";case 1:return"Official-Sensitive";case 2:return"Secret"}};n=function(n,t){var i,r,u,f,o,s,e;if(n!==void 0&&t!==void 0){for(u=0,o=t.length;u<o;u++)for(r=t[u],e=r.formats,f=0,s=e.length;f<s;f++)if(i=e[f],i.name===n)return{type:r.name,text:i.name,code:i.code,glyph:r.glyph};return{text:"None Selected",glyph:"glyphicon-th"}}return{text:"Other",glyph:"glyphicon-th"}};e=function(t,i,r){return r.gemini.dataFormat=t,n(t,i)};o={errors:[{message:"There was an error"},{message:"There was another error"}]}}).call(this);