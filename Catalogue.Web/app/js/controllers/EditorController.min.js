(function(){var f,n,t,i,r,u;angular.module("app.controllers").controller("EditorController",function(f,e,o,s,h,c){return f.editing={},f.lookups={},f.lookups.currentDataFormat={},f.record=h,f.vocabulator={},f.$=$,e.get("../api/topics").success(function(n){return f.lookups.topics=n}),e.get("../api/formats?q=").success(function(t){return f.lookups.currentDataFormat=n(f.form.gemini.dataFormat,t),f.lookups.formats=t}),e.get("../api/roles?q=").success(function(n){return f.lookups.roles=n}),f.collapseDataFormatSelector=!0,f.collapseDateFormat=!0,f.getSecurityText=r,f.getDataFormatObj=n,f.updateDataFormatObj=u,f.getPendingSignOff=i,f.getOpenDataButtonText=t,f.cancel=function(){return f.reset(),f.lookups.currentDataFormat=n(f.form.gemini.dataFormat,f.lookups.formats),f.notifications.add("Edits cancelled")},f.open=function(n,t){n.preventDefault();n.stopPropagation();f[t]=!0},f.successResponse=function(n){return f.reloadRecord(n),f.notifications.add("Edits saved")},f.reloadRecord=function(n){return f.record=n,f.validation={},f.reset(),s.path("/editor/"+f.record.id)},f.save=function(){var n;return n=function(n){var e,t,o,i,r,s,h,u;if(n.data.success)f.successResponse(n.data.record);else if(f.validation=n.data.validation,t=n.data.validation.errors,t.length>0)for(f.notifications.add("There were errors"),i=0,s=t.length;i<s;i++)for(e=t[i],u=e.fields,r=0,h=u.length;r<h;r++){o=u[r];try{f.theForm[o].$setValidity("server",!1)}catch(c){}}return f.busy.stop()},f.busy.start(),f.isNew()?e.post("../api/records",f.form).then(n):e.put("../api/records/"+f.record.id,f.form).then(n)},f.clone=function(){return s.path("/clone/"+f.form.id)},f.reset=function(){return f.form=angular.copy(f.record)},f.isNew=function(){return f.form.id==="00000000-0000-0000-0000-000000000000"},f.isClean=function(){return angular.equals(f.form,f.record)},f.isSaveHidden=function(){return f.isClean()||f.record.readOnly},f.isCancelHidden=function(){return f.isClean()},f.isSaveDisabled=function(){return f.isClean()},f.isCloneHidden=function(){return f.isNew()},f.isCloneDisabled=function(){return!f.isClean()},f.isPublishingModalButtonDisabled=function(){return!f.isSaveHidden()},f.hasUsageConstraints=function(){return!!f.form.gemini.limitationsOnPublicAccess&&f.form.gemini.limitationsOnPublicAccess!=="no limitations"||!!f.form.gemini.useConstraints&&f.form.gemini.useConstraints!=="no conditions apply"},f.removeKeyword=function(n){return f.form.gemini.keywords.splice($.inArray(n,f.form.gemini.keywords),1)},f.addKeywords=function(n){var r,t,u,i;for(i=[],t=0,u=n.length;t<u;t++)r=n[t],i.push(f.form.gemini.keywords.push(r));return i},f.editKeywords=function(){var n;return n=c.open({controller:"VocabulatorController",templateUrl:"views/partials/vocabulator.html?"+(new Date).getTime(),size:"lg",scope:f}),n.result.then(function(n){return f.addKeywords(n)})["finally"](function(){return f.editing.keywords=!0})},f.editAbstract=function(){var n;return n=c.open({controller:"MarkdownController",templateUrl:"views/partials/markdown.html?"+(new Date).getTime(),size:"lg",resolve:{markdown:function(){return f.form.gemini.abstract}}}),n.result.then(function(n){return f.form.gemini.abstract=n})},f.openPublishingModal=function(){var n;return n=c.open({controller:"OpenDataModalController",templateUrl:"views/partials/opendatamodal.html?"+(new Date).getTime(),size:"lg",scope:f,backdrop:"static"}),n.result.then(function(n){return f.reloadRecord(n)})},f.removeExtent=function(n){return f.form.gemini.extent.splice($.inArray(n,f.form.gemini.extent),1)},f.addExtent=function(){return f.form.gemini.extent===null&&(f.form.gemini.extent=[]),f.form.gemini.extent.push({authority:"",code:""})},f.reset(),f.getKeywords=function(n){return e.get("../api/keywords?q="+n).then(function(n){return n.data})},f.setKeyword=function(n,t){return t.vocab=n.vocab}});t=function(n){return n===null?"Not Open Data":n.openData.lastAttempt!==null?"Published":n.openData.signOff!==null?"Signed Off":n.openData.assessment.completed?"Assessed":"Not Open Data"};i=function(n){return n!==null&&n.openData.assessment.completed&&n.openData.signOff===null?!0:!1};r=function(n){switch(n){case 0:return"Official";case 1:return"Official-Sensitive";case 2:return"Secret"}};n=function(n,t){var i,r,u,f,o,s,e;if(n!==void 0&&t!==void 0){for(u=0,o=t.length;u<o;u++)for(r=t[u],e=r.formats,f=0,s=e.length;f<s;f++)if(i=e[f],i.name===n)return{type:r.name,text:i.name,code:i.code,glyph:r.glyph};return{text:"None Selected",glyph:"glyphicon-th"}}return{text:"Other",glyph:"glyphicon-th"}};u=function(t,i,r){return r.gemini.dataFormat=t,n(t,i)};f={errors:[{message:"There was an error"},{message:"There was another error"}]}}).call(this);