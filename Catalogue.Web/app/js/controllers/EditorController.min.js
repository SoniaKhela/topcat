(function(){var i,n,t;angular.module("app.controllers").controller("EditorController",function(i,r,u,f,e){i.lookups={};i.lookups.currentDataFormat={};r.get("../api/topics").success(function(n){return i.lookups.topics=n});r.get("../api/formats?q=").success(function(t){return i.lookups.currentDataFormat.glyph=n(i.form.gemini.dataFormat,t),i.lookups.currentDataFormat.text=i.form.gemini.dataFormat===null||i.form.gemini.dataFormat===""?"None Selected":i.form.gemini.dataFormat,i.lookups.formats=t});i.getSecurityText=t;i.getDataFormatIcon=n;i.cancel=function(){return i.reset(),i.notifications.add("Edits cancelled")};i.open=function(n,t){n.preventDefault();n.stopPropagation();i[t]=!0};i.save=function(){var n;return n=function(n){var s,t,h,r,u,c,l,o;if(n.data.success)e=n.data.record,i.validation={},i.reset(),i.notifications.add("Edits saved"),f.path("/editor/"+e.id);else for(i.validation=n.data.validation,t=n.data.validation.errors,t.length>0&&i.notifications.add("There were errors"),r=0,c=t.length;r<c;r++)for(s=t[r],o=s.fields,u=0,l=o.length;u<l;u++)h=o[u],i.theForm[h].$setValidity("server",!1);return i.busy.stop()},i.busy.start(),u.recordId!=="00000000-0000-0000-0000-000000000000"?r.put("../api/records/"+e.id,i.form).then(n):r.post("../api/records",i.form).then(n)};i.reset=function(){return i.form=angular.copy(e)};i.isClean=function(){return angular.equals(i.form,e)};i.isSaveHidden=function(){return i.isClean()||e.readOnly};i.isCancelHidden=function(){return i.isClean()};i.isSaveDisabled=function(){return i.isClean()};i.removeKeyword=function(n){return i.form.gemini.keywords.splice($.inArray(n,i.form.gemini.keywords),1)};i.addKeyword=function(){return i.form.gemini.keywords.push({vocab:"",value:""})};i.reset()});t=function(n){switch(n){case 0:return"Open";case 1:return"Restricted";case 2:return"Classified"}};n=function(n,t){for(var e,u,r,s,f,i=0,o=t.length;i<o;i++)for(u=t[i],f=u.formats,r=0,s=f.length;r<s;r++)if(e=f[r],e.name===n)return u.glyph;return"glyphicon-th"};i={errors:[{message:"There was an error"},{message:"There was another error"}]}}).call(this)