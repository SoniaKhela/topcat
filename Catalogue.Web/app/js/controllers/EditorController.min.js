(function(){var e,n,t,i,r,u,f;angular.module("app.controllers").controller("EditorController",function(e,o,s,h,c,l){return e.editing={},e.lookups={},e.lookups.currentDataFormat={},e.recordOutput=c,e.vocabulator={},e.$=$,o.get("../api/topics").success(function(n){return e.lookups.topics=n}),o.get("../api/formats?q=").success(function(t){return e.lookups.currentDataFormat=n(e.form.gemini.dataFormat,t),e.lookups.formats=t}),o.get("../api/roles?q=").success(function(n){return e.lookups.roles=n}),e.collapseDataFormatSelector=!0,e.collapseDateFormat=!0,e.getSecurityText=u,e.getDataFormatObj=n,e.updateDataFormatObj=f,e.getPendingSignOff=r,e.getOpenDataButtonText=t,e.getOpenDataButtonToolTip=i,e.cancel=function(){return e.reset(),e.lookups.currentDataFormat=n(e.form.gemini.dataFormat,e.lookups.formats),e.notifications.add("Edits cancelled")},e.open=function(n,t){n.preventDefault();n.stopPropagation();e[t]=!0},e.successResponse=function(n){return e.reloadRecord(n),e.notifications.add("Edits saved")},e.reloadRecord=function(n){return e.recordOutput={record:n.record,recordState:n.recordState},e.validation={},e.reset(),e.status.refresh(),h.path("/editor/"+e.recordOutput.record.id)},e.save=function(){var n;return n=function(n){var f,t,o,i,r,s,h,u;if(n.data.success)e.successResponse(n.data);else if(e.validation=n.data.validation,t=n.data.validation.errors,t.length>0)for(e.notifications.add("There were errors"),i=0,s=t.length;i<s;i++)for(f=t[i],u=f.fields,r=0,h=u.length;r<h;r++){o=u[r];try{e.theForm[o].$setValidity("server",!1)}catch(c){}}return e.busy.stop()},e.busy.start(),e.isNew()?o.post("../api/records",e.form).then(n):o.put("../api/records/"+e.recordOutput.record.id,e.form).then(n)},e.clone=function(){return h.path("/clone/"+e.form.id)},e.reset=function(){return e.form=angular.copy(e.recordOutput.record)},e.isNew=function(){return e.form.id==="00000000-0000-0000-0000-000000000000"},e.isClean=function(){return angular.equals(e.form,e.recordOutput.record)},e.isSaveHidden=function(){return e.isClean()||e.recordOutput.record.readOnly},e.isCancelHidden=function(){return e.isClean()},e.isSaveDisabled=function(){return e.isClean()},e.isCloneHidden=function(){return e.isNew()},e.isCloneDisabled=function(){return!e.isClean()},e.isPublishingModalButtonDisabled=function(){return!e.isSaveHidden()},e.hasUsageConstraints=function(){return!!e.form.gemini.limitationsOnPublicAccess&&e.form.gemini.limitationsOnPublicAccess!=="no limitations"||!!e.form.gemini.useConstraints&&e.form.gemini.useConstraints!=="no conditions apply"},e.removeKeyword=function(n){return e.form.gemini.keywords.splice($.inArray(n,e.form.gemini.keywords),1)},e.addKeywords=function(n){var r,t,u,i;for(i=[],t=0,u=n.length;t<u;t++)r=n[t],i.push(e.form.gemini.keywords.push(r));return i},e.editKeywords=function(){var n;return n=l.open({controller:"VocabulatorController",templateUrl:"views/partials/vocabulator.html?"+(new Date).getTime(),size:"lg",scope:e}),n.result.then(function(n){return e.addKeywords(n)})["finally"](function(){return e.editing.keywords=!0})},e.editAbstract=function(){var n;return n=l.open({controller:"MarkdownController",templateUrl:"views/partials/markdown.html?"+(new Date).getTime(),size:"lg",resolve:{markdown:function(){return e.form.gemini.abstract}}}),n.result.then(function(n){return e.form.gemini.abstract=n})},e.openPublishingModal=function(){var n;return n=l.open({controller:"OpenDataModalController",templateUrl:"views/partials/opendatamodal.html?"+(new Date).getTime(),size:"lg",scope:e,resolve:{recordOutput:function(){return e.recordOutput}},backdrop:"static"}),n.result.then(function(n){return e.reloadRecord(n)})},e.removeExtent=function(n){return e.form.gemini.extent.splice($.inArray(n,e.form.gemini.extent),1)},e.addExtent=function(){return e.form.gemini.extent===null&&(e.form.gemini.extent=[]),e.form.gemini.extent.push({authority:"",code:""})},e.reset(),e.getKeywords=function(n){return o.get("../api/keywords?q="+n).then(function(n){return n.data})},e.setKeyword=function(n,t){return t.vocab=n.vocab}});i=function(n,t){return n.publication===null?"The open data publication status of the record, editing the record may affect the status.":n.publication.openData.lastSuccess===null||t.assessedAndUpToDate?"The open data publication status of the record, editing the record may affect the status.":"This record has been changed since it was last published, it may need republishing."};t=function(n,t){return n.publication===null?"Not Open Data":n.publication.openData.lastSuccess===null||t.assessedAndUpToDate?t.uploadedAndUpToDate?"Published":t.signedOffAndUpToDate?"Signed Off":t.assessedAndUpToDate?"Assessed":"Not Open Data":"Republish"};r=function(n){return n!==null&&n.openData.assessment.completed&&n.openData.signOff===null?!0:!1};u=function(n){switch(n){case 0:return"Official";case 1:return"Official-Sensitive";case 2:return"Secret"}};n=function(n,t){var i,r,u,f,o,s,e;if(n!==void 0&&t!==void 0){for(u=0,o=t.length;u<o;u++)for(r=t[u],e=r.formats,f=0,s=e.length;f<s;f++)if(i=e[f],i.name===n)return{type:r.name,text:i.name,code:i.code,glyph:r.glyph};return{text:"None Selected",glyph:"glyphicon-th"}}return{text:"Other",glyph:"glyphicon-th"}};f=function(t,i,r){return r.gemini.dataFormat=t,n(t,i)};e={errors:[{message:"There was an error"},{message:"There was another error"}]}}).call(this);